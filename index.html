<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jurnal 7 Kebiasaan Anak Indonesia Hebat</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Poppins', sans-serif; }
        .journal-page { 
            background: linear-gradient(135deg, #fef7cd 0%, #fff9e6 100%);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        .habit-row { 
            border-bottom: 2px dotted #d1d5db;
            transition: all 0.3s ease;
        }
        .habit-row:hover { background-color: rgba(255,255,255,0.5); }
        .checkbox-custom {
            width: 24px;
            height: 24px;
            border: 2px solid #6b7280;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }
        .checkbox-custom.checked {
            background-color: #10b981;
            border-color: #10b981;
            position: relative;
        }
        .checkbox-custom.checked::after {
            content: '‚úì';
            color: white;
            font-weight: bold;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 14px;
        }
        .reflection-box {
            background: rgba(255,255,255,0.7);
            border: 2px dashed #9ca3af;
            min-height: 120px;
        }
        .date-header {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
        }
        .print-friendly { 
            background: white !important;
            color: black !important;
        }
        
        /* Enhanced Mobile Styles */
        @media (max-width: 768px) {
            body { padding: 8px; }
            .journal-page { padding: 16px; }
            .habit-row { 
                flex-direction: column; 
                align-items: flex-start; 
                padding: 12px; 
                gap: 8px;
            }
            .habit-row .flex-1 { width: 100%; }
            .habit-row .text-right { 
                width: 100%; 
                text-align: left; 
                display: flex;
                align-items: center;
                gap: 8px;
                flex-wrap: wrap;
            }
            .habit-detail, .habit-duration, .habit-time {
                min-width: 80px;
                padding: 4px 8px;
            }
            .date-header .flex {
                flex-direction: column;
                gap: 12px;
            }
            .date-header button {
                order: 3;
                width: 100%;
                justify-content: center;
            }
            .grid { gap: 12px; }
            .grid.md\\:grid-cols-2 { grid-template-columns: 1fr; }
            .space-x-4 { 
                flex-direction: column; 
                gap: 12px; 
                align-items: center;
            }
            .space-x-4 > * { margin: 0; width: 100%; max-width: 300px; }
            h1 { font-size: 1.875rem; }
            h2 { font-size: 1.25rem; }
            h3 { font-size: 1.125rem; }
        }
        
        @media (max-width: 480px) {
            .text-4xl { font-size: 1.5rem; }
            .text-2xl { font-size: 1.25rem; }
            .text-xl { font-size: 1.125rem; }
            .p-8 { padding: 12px; }
            .p-6 { padding: 12px; }
            .p-4 { padding: 8px; }
        }
        
        @media print {
            body { background: white !important; }
            .journal-page { background: white !important; box-shadow: none !important; }
            .no-print { display: none !important; }
        }
        
        /* Loading spinner */
        .spinner {
            border: 2px solid #f3f3f3;
            border-top: 2px solid #3498db;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-left: 8px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-100 to-purple-100 min-h-screen p-4">
    <div class="max-w-4xl mx-auto">
        <!-- Header -->
        <div class="text-center mb-6">
            <h1 class="text-4xl font-bold text-blue-800 mb-2">JURNAL HARIAN</h1>
            <h2 class="text-2xl font-semibold text-blue-600">7 Kebiasaan Anak Indonesia Hebat</h2>
            <h3 class="text-xl font-semibold text-blue-900">SDN CAKUNG BARAT 01</h3>
        </div>

        <!-- Google Spreadsheet Configuration -->
        <div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 mb-6 rounded no-print">
            <div class="flex items-start">
                <div class="flex-shrink-0">
                    <svg class="h-5 w-5 text-yellow-400" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                    </svg>
                </div>
                <div class="ml-3">
                    <p class="text-sm">
                        <strong>Konfigurasi Google Spreadsheet:</strong><br>
                        Untuk menyimpan data ke Google Spreadsheet, silakan ganti URL di dalam kode JavaScript dengan URL Google Apps Script Anda.
                        <br><small>Petunjuk setup ada di komentar kode JavaScript.</small>
                    </p>
                </div>
            </div>
        </div>

        <!-- Journal Page -->
        <div class="journal-page rounded-2xl p-8 mb-6">
            <!-- Date Section -->
            <div class="date-header text-white rounded-xl p-4 mb-6 text-center">
                <div class="flex justify-between items-center">
                    <button onclick="changeDate(-1)" class="no-print bg-white bg-opacity-20 hover:bg-opacity-30 rounded-full px-4 py-2 transition-colors">
                        ‚Üê Kemarin
                    </button>
                    <div>
                        <h3 class="text-2xl font-bold" id="currentDate"></h3>
                        <p class="text-blue-100" id="currentDay"></p>
                    </div>
                    <button onclick="changeDate(1)" class="no-print bg-white bg-opacity-20 hover:bg-opacity-30 rounded-full px-4 py-2 transition-colors">
                        Besok ‚Üí
                    </button>
                </div>
            </div>

            <!-- Personal Info -->
            <div class="grid md:grid-cols-2 gap-4 mb-6">
                <div class="bg-white bg-opacity-60 rounded-lg p-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Nama:</label>
                    <input type="text" id="studentName" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-400 focus:border-transparent" placeholder="Tulis namamu di sini..." required>
                </div>
                <div class="bg-white bg-opacity-60 rounded-lg p-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Kelas:</label>
                    <input type="text" id="studentClass" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-400 focus:border-transparent" placeholder="Contoh: 3A" required>
                </div>
            </div>

            <!-- 7 Habits Checklist -->
            <div class="bg-white bg-opacity-60 rounded-lg p-6 mb-6">
                <h3 class="text-xl font-bold text-gray-800 mb-4 text-center">‚úÖ CHECKLIST 7 KEBIASAAN HEBAT</h3>
                
                <div class="space-y-4">
                    <!-- Habit 1 -->
                    <div class="habit-row flex items-center p-3 rounded-lg" data-habit="0">
                        <div class="checkbox-custom mr-4" onclick="toggleHabit(0)"></div>
                        <div class="flex-1">
                            <div class="flex items-center">
                                <span class="text-2xl mr-3">üôè</span>
                                <div>
                                    <h4 class="font-semibold text-gray-800">1. Berdoa & Beribadah</h4>
                                    <p class="text-sm text-gray-600">Memulai dan mengakhiri hari dengan berdoa</p>
                                </div>
                            </div>
                        </div>
                        <div class="text-right">
                            <span class="text-xs text-gray-500">Waktu:</span>
                            <input type="time" class="habit-time ml-2 p-1 text-xs border rounded" data-habit="0">
                        </div>
                    </div>

                    <!-- Habit 2 -->
                    <div class="habit-row flex items-center p-3 rounded-lg" data-habit="1">
                        <div class="checkbox-custom mr-4" onclick="toggleHabit(1)"></div>
                        <div class="flex-1">
                            <div class="flex items-center">
                                <span class="text-2xl mr-3">üìö</span>
                                <div>
                                    <h4 class="font-semibold text-gray-800">2. Membaca Buku</h4>
                                    <p class="text-sm text-gray-600">Membaca minimal 15 menit setiap hari</p>
                                </div>
                            </div>
                        </div>
                        <div class="text-right">
                            <span class="text-xs text-gray-500">Durasi:</span>
                            <input type="number" min="0" max="180" class="habit-duration ml-2 p-1 text-xs border rounded w-16" placeholder="15" data-habit="1">
                            <span class="text-xs text-gray-500">menit</span>
                        </div>
                    </div>

                    <!-- Habit 3 -->
                    <div class="habit-row flex items-center p-3 rounded-lg" data-habit="2">
                        <div class="checkbox-custom mr-4" onclick="toggleHabit(2)"></div>
                        <div class="flex-1">
                            <div class="flex items-center">
                                <span class="text-2xl mr-3">üèÉ</span>
                                <div>
                                    <h4 class="font-semibold text-gray-800">3. Olahraga & Bergerak Aktif</h4>
                                    <p class="text-sm text-gray-600">Berolahraga atau bergerak aktif minimal 30 menit</p>
                                </div>
                            </div>
                        </div>
                        <div class="text-right">
                            <span class="text-xs text-gray-500">Jenis:</span>
                            <input type="text" class="habit-detail ml-2 p-1 text-xs border rounded w-20" placeholder="Lari" data-habit="2">
                        </div>
                    </div>

                    <!-- Habit 4 -->
                    <div class="habit-row flex items-center p-3 rounded-lg" data-habit="3">
                        <div class="checkbox-custom mr-4" onclick="toggleHabit(3)"></div>
                        <div class="flex-1">
                            <div class="flex items-center">
                                <span class="text-2xl mr-3">ü§ù</span>
                                <div>
                                    <h4 class="font-semibold text-gray-800">4. Membantu Orang Tua</h4>
                                    <p class="text-sm text-gray-600">Membantu pekerjaan rumah dan menghormati orang tua</p>
                                </div>
                            </div>
                        </div>
                        <div class="text-right">
                            <span class="text-xs text-gray-500">Bantuan:</span>
                            <input type="text" class="habit-detail ml-2 p-1 text-xs border rounded w-24" placeholder="Cuci piring" data-habit="3">
                        </div>
                    </div>

                    <!-- Habit 5 -->
                    <div class="habit-row flex items-center p-3 rounded-lg" data-habit="4">
                        <div class="checkbox-custom mr-4" onclick="toggleHabit(4)"></div>
                        <div class="flex-1">
                            <div class="flex items-center">
                                <span class="text-2xl mr-3">üéØ</span>
                                <div>
                                    <h4 class="font-semibold text-gray-800">5. Belajar dengan Fokus</h4>
                                    <p class="text-sm text-gray-600">Mengerjakan tugas sekolah dengan konsentrasi penuh</p>
                                </div>
                            </div>
                        </div>
                        <div class="text-right">
                            <span class="text-xs text-gray-500">Mata Pelajaran:</span>
                            <input type="text" class="habit-detail ml-2 p-1 text-xs border rounded w-20" placeholder="Matematika" data-habit="4">
                        </div>
                    </div>

                    <!-- Habit 6 -->
                    <div class="habit-row flex items-center p-3 rounded-lg" data-habit="5">
                        <div class="checkbox-custom mr-4" onclick="toggleHabit(5)"></div>
                        <div class="flex-1">
                            <div class="flex items-center">
                                <span class="text-2xl mr-3">üëç</span>
                                <div>
                                    <h4 class="font-semibold text-gray-800">6. Berbuat Baik</h4>
                                    <p class="text-sm text-gray-600">Melakukan kebaikan kepada sesama dan lingkungan</p>
                                </div>
                            </div>
                        </div>
                        <div class="text-right">
                            <span class="text-xs text-gray-500">Kebaikan:</span>
                            <input type="text" class="habit-detail ml-2 p-1 text-xs border rounded w-24" placeholder="Membantu teman" data-habit="5">
                        </div>
                    </div>

                    <!-- Habit 7 -->
                    <div class="habit-row flex items-center p-3 rounded-lg" data-habit="6">
                        <div class="checkbox-custom mr-4" onclick="toggleHabit(6)"></div>
                        <div class="flex-1">
                            <div class="flex items-center">
                                <span class="text-2xl mr-3">üåü</span>
                                <div>
                                    <h4 class="font-semibold text-gray-800">7. Bersyukur</h4>
                                    <p class="text-sm text-gray-600">Menulis hal-hal yang disyukuri hari ini</p>
                                </div>
                            </div>
                        </div>
                        <div class="text-right">
                            <span class="text-xs text-green-600 font-medium" id="gratitudeCount">0/3</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Gratitude Section -->
            <div class="bg-white bg-opacity-60 rounded-lg p-6 mb-6">
                <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                    <span class="text-2xl mr-2">üôè</span>
                    Hari ini saya bersyukur karena...
                </h3>
                <div class="space-y-3">
                    <div class="flex items-start">
                        <span class="text-blue-600 font-bold mr-3 mt-1">1.</span>
                        <textarea id="gratitude1" rows="2" class="flex-1 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-400 focus:border-transparent resize-none" placeholder="Tulis hal pertama yang kamu syukuri..."></textarea>
                    </div>
                    <div class="flex items-start">
                        <span class="text-blue-600 font-bold mr-3 mt-1">2.</span>
                        <textarea id="gratitude2" rows="2" class="flex-1 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-400 focus:border-transparent resize-none" placeholder="Tulis hal kedua yang kamu syukuri..."></textarea>
                    </div>
                    <div class="flex items-start">
                        <span class="text-blue-600 font-bold mr-3 mt-1">3.</span>
                        <textarea id="gratitude3" rows="2" class="flex-1 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-400 focus:border-transparent resize-none" placeholder="Tulis hal ketiga yang kamu syukuri..."></textarea>
                    </div>
                </div>
            </div>

            <!-- Daily Reflection -->
            <div class="bg-white bg-opacity-60 rounded-lg p-6 mb-6">
                <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                    <span class="text-2xl mr-2">üí≠</span>
                    Refleksi Hari Ini
                </h3>
                <div class="grid md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Pencapaian terbaik hari ini:</label>
                        <textarea id="achievement" rows="3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-400 focus:border-transparent resize-none" placeholder="Apa yang membuatmu bangga hari ini?"></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Yang ingin diperbaiki besok:</label>
                        <textarea id="improvement" rows="3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-400 focus:border-transparent resize-none" placeholder="Apa yang bisa kamu lakukan lebih baik?"></textarea>
                    </div>
                </div>
            </div>

            <!-- Mood & Energy -->
            <div class="bg-white bg-opacity-60 rounded-lg p-6 mb-6">
                <h3 class="text-lg font-bold text-gray-800 mb-4">üìä Suasana Hati & Energi</h3>
                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-3">Suasana Hati:</label>
                        <div class="flex justify-between">
                            <button onclick="setMood(1)" class="mood-btn text-3xl p-2 rounded-lg hover:bg-gray-100 transition-colors" data-mood="1">üò¢</button>
                            <button onclick="setMood(2)" class="mood-btn text-3xl p-2 rounded-lg hover:bg-gray-100 transition-colors" data-mood="2">üòê</button>
                            <button onclick="setMood(3)" class="mood-btn text-3xl p-2 rounded-lg hover:bg-gray-100 transition-colors" data-mood="3">üôÇ</button>
                            <button onclick="setMood(4)" class="mood-btn text-3xl p-2 rounded-lg hover:bg-gray-100 transition-colors" data-mood="4">üòä</button>
                            <button onclick="setMood(5)" class="mood-btn text-3xl p-2 rounded-lg hover:bg-gray-100 transition-colors" data-mood="5">üòÑ</button>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-3">Level Energi:</label>
                        <div class="flex items-center space-x-2">
                            <span class="text-sm text-gray-600">Rendah</span>
                            <input type="range" id="energyLevel" min="1" max="10" value="5" class="flex-1">
                            <span class="text-sm text-gray-600">Tinggi</span>
                            <span id="energyValue" class="text-sm font-bold text-blue-600 ml-2">5</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Progress Summary -->
            <div class="bg-gradient-to-r from-green-400 to-blue-500 text-white rounded-lg p-6 text-center">
                <h3 class="text-xl font-bold mb-2">üéØ Progress Hari Ini</h3>
                <div class="text-4xl font-bold mb-2" id="progressPercentage">0%</div>
                <div class="text-lg" id="progressMessage">Ayo semangat menyelesaikan kebiasaan hebatmu!</div>
                <div class="mt-4 bg-white bg-opacity-20 rounded-full h-4">
                    <div id="progressBar" class="bg-white rounded-full h-4 transition-all duration-500" style="width: 0%"></div>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex justify-center space-x-4 mb-6 no-print">
            <button onclick="saveJournal()" class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg font-medium transition-colors">
                üíæ Simpan Jurnal
            </button>
            <button onclick="saveToSpreadsheet()" class="bg-purple-500 hover:bg-purple-600 text-white px-6 py-3 rounded-lg font-medium transition-colors" id="spreadsheetBtn">
                üìä Simpan ke Spreadsheet
            </button>
            <button onclick="printJournal()" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg font-medium transition-colors">
                üñ®Ô∏è Cetak Jurnal
            </button>
            <button onclick="resetJournal()" class="bg-red-500 hover:bg-red-600 text-white px-6 py-3 rounded-lg font-medium transition-colors">
                üîÑ Reset
            </button>
        </div>
    </div>

    <script>
        // KONFIGURASI GOOGLE SPREADSHEET
        // 1. Buat Google Spreadsheet baru
        // 2. Buka Extensions -> Apps Script
        // 3. Copy kode berikut ke Apps Script:
        /*
        function doPost(e) {
            var ss = SpreadsheetApp.openById('1JWR28cu9WqAe6xC6G5-Dyp-NjrmJb-isq7_s99KVdsA'); // Ganti dengan ID spreadsheet Anda
            var sheet = ss.getActiveSheet();
            
            var data = JSON.parse(e.postData.contents);
            
            // Header kolom (tambahkan di baris pertama spreadsheet jika belum ada)
            var headers = [
                'Timestamp', 'Tanggal', 'Nama', 'Kelas', 'Berdoa', 'Membaca', 'Olahraga', 
                'Membantu Ortu', 'Belajar', 'Berbuat Baik', 'Bersyukur', 'Suasana Hati', 
                'Level Energi', 'Syukur 1', 'Syukur 2', 'Syukur 3', 'Pencapaian', 'Perbaikan',
                'Waktu Berdoa', 'Durasi Baca', 'Jenis Olahraga', 'Bantuan Ortu', 'Mata Pelajaran', 'Kebaikan'
            ];
            
            // Jika sheet kosong, tambahkan header
            if (sheet.getLastRow() === 0) {
                sheet.getRange(1, 1, 1, headers.length).setValues([headers]);
            }
            
            // Tambahkan data baru
            var newRow = [
                new Date(),
                data.date,
                data.name,
                data.class,
                data.habits[0] ? 'Ya' : 'Tidak',
                data.habits[1] ? 'Ya' : 'Tidak',
                data.habits[2] ? 'Ya' : 'Tidak',
                data.habits[3] ? 'Ya' : 'Tidak',
                data.habits[4] ? 'Ya' : 'Tidak',
                data.habits[5] ? 'Ya' : 'Tidak',
                data.habits[6] ? 'Ya' : 'Tidak',
                data.mood,
                data.energy,
                data.gratitude1,
                data.gratitude2,
                data.gratitude3,
                data.achievement,
                data.improvement,
                data.habitDetails[0] || '',
                data.habitDetails[1] || '',
                data.habitDetails[2] || '',
                data.habitDetails[3] || '',
                data.habitDetails[4] || '',
                data.habitDetails[5] || ''
            ];
            
            sheet.appendRow(newRow);
            
            return ContentService.createTextOutput(JSON.stringify({success: true}))
                .setMimeType(ContentService.MimeType.JSON);
        }
        */
        // 4. Deploy sebagai Web App dengan akses untuk Anyone
        // 5. Copy URL deployment dan ganti variabel GOOGLE_SCRIPT_URL di bawah

        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbz8aU_fM1ZrK0bt07_UcDDmj95xkehXTnOCE3MFyOvQJzHcc3pRUdVs-G4DgTc3UakS/exec'; // Ganti dengan URL Apps Script Anda

        let currentDate = new Date();
        let habits = Array(7).fill(false);
        let selectedMood = 0;
        let journalData = {};

        // Initialize
        function init() {
            updateDateDisplay();
            loadJournalData();
            setupEventListeners();
            updateProgress();
        }

        // Update date display
        function updateDateDisplay() {
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('currentDate').textContent = currentDate.toLocaleDateString('id-ID', options);
            document.getElementById('currentDay').textContent = `Hari ke-${Math.ceil((currentDate - new Date(currentDate.getFullYear(), 0, 1)) / (1000 * 60 * 60 * 24))} tahun ${currentDate.getFullYear()}`;
        }

        // Change date
        function changeDate(days) {
            saveCurrentJournal();
            currentDate.setDate(currentDate.getDate() + days);
            updateDateDisplay();
            loadJournalData();
        }

        // Toggle habit
        function toggleHabit(index) {
            habits[index] = !habits[index];
            const checkbox = document.querySelector(`[data-habit="${index}"] .checkbox-custom`);
            checkbox.classList.toggle('checked', habits[index]);
            updateProgress();
            updateGratitudeCount();
        }

        // Set mood
        function setMood(mood) {
            selectedMood = mood;
            document.querySelectorAll('.mood-btn').forEach(btn => {
                btn.classList.remove('bg-yellow-200');
            });
            document.querySelector(`[data-mood="${mood}"]`).classList.add('bg-yellow-200');
        }

        // Update progress
        function updateProgress() {
            const completed = habits.filter(h => h).length;
            const percentage = Math.round((completed / habits.length) * 100);
            
            document.getElementById('progressPercentage').textContent = percentage + '%';
            document.getElementById('progressBar').style.width = percentage + '%';
            
            let message = '';
            if (percentage === 100) {
                message = 'üéâ Luar biasa! Kamu menyelesaikan semua kebiasaan hebat!';
            } else if (percentage >= 70) {
                message = 'üëè Hebat! Kamu hampir menyelesaikan semuanya!';
            } else if (percentage >= 40) {
                message = 'üí™ Bagus! Terus semangat menyelesaikan yang lain!';
            } else {
                message = 'üåü Ayo semangat menyelesaikan kebiasaan hebatmu!';
            }
            
            document.getElementById('progressMessage').textContent = message;
        }

        // Update gratitude count
        function updateGratitudeCount() {
            const gratitude1 = document.getElementById('gratitude1').value.trim();
            const gratitude2 = document.getElementById('gratitude2').value.trim();
            const gratitude3 = document.getElementById('gratitude3').value.trim();
            
            let count = 0;
            if (gratitude1) count++;
            if (gratitude2) count++;
            if (gratitude3) count++;
            
            document.getElementById('gratitudeCount').textContent = `${count}/3`;
            
            // Auto-check gratitude habit if all 3 are filled
            if (count === 3 && !habits[6]) {
                toggleHabit(6);
            }
        }

        // Setup event listeners
        function setupEventListeners() {
            // Energy level slider
            document.getElementById('energyLevel').addEventListener('input', function() {
                document.getElementById('energyValue').textContent = this.value;
            });

            // Gratitude text areas
            ['gratitude1', 'gratitude2', 'gratitude3'].forEach(id => {
                document.getElementById(id).addEventListener('input', updateGratitudeCount);
            });

            // Auto-save on input changes
            const inputs = document.querySelectorAll('input, textarea');
            inputs.forEach(input => {
                input.addEventListener('change', saveCurrentJournal);
            });
        }

        // Save current journal to local storage
        function saveCurrentJournal() {
            const dateKey = currentDate.toDateString();
            journalData[dateKey] = {
                habits: [...habits],
                mood: selectedMood,
                energy: document.getElementById('energyLevel').value,
                name: document.getElementById('studentName').value,
                class: document.getElementById('studentClass').value,
                gratitude1: document.getElementById('gratitude1').value,
                gratitude2: document.getElementById('gratitude2').value,
                gratitude3: document.getElementById('gratitude3').value,
                achievement: document.getElementById('achievement').value,
                improvement: document.getElementById('improvement').value,
                habitDetails: Array.from(document.querySelectorAll('.habit-time, .habit-duration, .habit-detail')).map(el => el.value)
            };
            
            // Use regular variables instead of localStorage for Claude environment
            window.journalStorage = journalData;
        }

        // Load journal data
        function loadJournalData() {
            // Load from window storage in Claude environment
            if (window.journalStorage) {
                journalData = window.journalStorage;
            }

            const dateKey = currentDate.toDateString();
            const data = journalData[dateKey];

            if (data) {
                habits = [...data.habits];
                selectedMood = data.mood || 0;
                
                // Update UI
                habits.forEach((completed, index) => {
                    const checkbox = document.querySelector(`[data-habit="${index}"] .checkbox-custom`);
                    checkbox.classList.toggle('checked', completed);
                });

                if (selectedMood > 0) {
                    setMood(selectedMood);
                }

                // Restore form values
                document.getElementById('energyLevel').value = data.energy || 5;
                document.getElementById('energyValue').textContent = data.energy || 5;
                document.getElementById('studentName').value = data.name || '';
                document.getElementById('studentClass').value = data.class || '';
                document.getElementById('gratitude1').value = data.gratitude1 || '';
                document.getElementById('gratitude2').value = data.gratitude2 || '';
                document.getElementById('gratitude3').value = data.gratitude3 || '';
                document.getElementById('achievement').value = data.achievement || '';
                document.getElementById('improvement').value = data.improvement || '';

                if (data.habitDetails) {
                    const detailInputs = document.querySelectorAll('.habit-time, .habit-duration, .habit-detail');
                    detailInputs.forEach((input, index) => {
                        if (data.habitDetails[index]) {
                            input.value = data.habitDetails[index];
                        }
                    });
                }
            } else {
                // Reset for new date
                habits = Array(7).fill(false);
                selectedMood = 0;
                document.querySelectorAll('.checkbox-custom').forEach(cb => cb.classList.remove('checked'));
                document.querySelectorAll('.mood-btn').forEach(btn => btn.classList.remove('bg-yellow-200'));
                document.getElementById('energyLevel').value = 5;
                document.getElementById('energyValue').textContent = 5;
            }

            updateProgress();
            updateGratitudeCount();
        }

        // Validate form data
        function validateForm() {
            const name = document.getElementById('studentName').value.trim();
            const studentClass = document.getElementById('studentClass').value.trim();
            
            if (!name) {
                alert('‚ö†Ô∏è Nama harus diisi!');
                document.getElementById('studentName').focus();
                return false;
            }
            
            if (!studentClass) {
                alert('‚ö†Ô∏è Kelas harus diisi!');
                document.getElementById('studentClass').focus();
                return false;
            }
            
            return true;
        }

        // Save to Google Spreadsheet
        async function saveToSpreadsheet() {
            if (!validateForm()) {
                return;
            }

            const btn = document.getElementById('spreadsheetBtn');
            const originalText = btn.innerHTML;
            
            // Show loading state
            btn.innerHTML = '‚è≥ Menyimpan... <div class="spinner"></div>';
            btn.disabled = true;

            try {
                // Prepare data for spreadsheet
                const data = {
                    date: currentDate.toLocaleDateString('id-ID'),
                    name: document.getElementById('studentName').value,
                    class: document.getElementById('studentClass').value,
                    habits: habits,
                    mood: getMoodText(selectedMood),
                    energy: document.getElementById('energyLevel').value,
                    gratitude1: document.getElementById('gratitude1').value,
                    gratitude2: document.getElementById('gratitude2').value,
                    gratitude3: document.getElementById('gratitude3').value,
                    achievement: document.getElementById('achievement').value,
                    improvement: document.getElementById('improvement').value,
                    habitDetails: Array.from(document.querySelectorAll('.habit-time, .habit-duration, .habit-detail')).map(el => el.value)
                };

                // Send to Google Apps Script
                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    const result = await response.json();
                    if (result.success) {
                        alert('‚úÖ Data berhasil disimpan ke Google Spreadsheet!');
                        saveCurrentJournal(); // Also save locally
                    } else {
                        throw new Error('Response tidak berhasil');
                    }
                } else {
                    throw new Error('Network response tidak ok');
                }

            } catch (error) {
                console.error('Error:', error);
                alert('‚ùå Gagal menyimpan ke Google Spreadsheet. Pastikan URL Google Apps Script sudah benar dan aplikasi sudah di-deploy dengan akses public.\n\nError: ' + error.message);
            } finally {
                // Reset button
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        }

        // Get mood text
        function getMoodText(mood) {
            const moodTexts = {
                1: 'Sedih',
                2: 'Biasa',
                3: 'Senang',
                4: 'Gembira',
                5: 'Sangat Gembira'
            };
            return moodTexts[mood] || 'Belum dipilih';
        }

        // Save journal locally
        function saveJournal() {
            if (!validateForm()) {
                return;
            }
            
            saveCurrentJournal();
            alert('‚úÖ Jurnal berhasil disimpan secara lokal!');
        }

        // Print journal
        function printJournal() {
            saveCurrentJournal();
            window.print();
        }

        // Reset journal
        function resetJournal() {
            if (confirm('Yakin ingin mereset jurnal hari ini? Semua data akan hilang!')) {
                const dateKey = currentDate.toDateString();
                delete journalData[dateKey];
                window.journalStorage = journalData;
                loadJournalData();
                
                // Clear all inputs
                document.querySelectorAll('input[type="text"], input[type="number"], input[type="time"], textarea').forEach(input => {
                    input.value = '';
                });
                
                // Reset mood
                document.querySelectorAll('.mood-btn').forEach(btn => btn.classList.remove('bg-yellow-200'));
                selectedMood = 0;
                
                alert('üîÑ Jurnal berhasil direset!');
            }
        }

        // Initialize app
        init();
    </script>
</body>
</html>

